- name: check for katello-cert
  yum:
    list:   "katello-ca-consumer-{{ satellite_fqdn }}.noarch"
  register: katello_cert

- name: "check for {{ satellite_fqdn }} in /etc/rhsm/rhsm.conf"
  slurp:
    src: /etc/rhsm/rhsm.conf
  register: rhsm

- shell:         "/usr/bin/grep -riL 'baseurl'"
  args:
    chdir:       "/etc/yum.repos.d/"
  ignore_errors: true
  register:      files

- set_fact:
    rhsm_fqdn:    "hostname = {{ satellite_fqdn }}"

- set_fact:
    rhsm:         "{{ rhsm.content | b64decode | regex_findall(rhsm_fqdn) }}"
    katello_cert: "{{ katello_cert.results[0].name.split() }}"
    files:        "{{ files.stdout_lines }}"
